<?xml version="1.0"?>
<launch>
    <arg name="veh" description="Name of vehicle. ex: megaman"/>
    <arg name="param_file_name" default="default" description="Specify a param file. ex:default."/>
    <arg name="robot_type"
         description="The type of the robot, e.g., duckiebot, watchtower, traffic_light, ..."/>
    <arg name="robot_configuration"
         description="The configuration of the robot. For example DB19, DB20, ..."/>
    <let name="robot_xurdf" value="$(find-pkg-share duckiebot_interface)/urdf/$(var robot_type).urdf.xacro"/>
    <arg name="camera_disabled" default="$(env DT_SENSOR_CAMERA_DISABLE 0)"
         description="If 1 the camera node is not started."/>

    <set_parameter name="robot_description" value="$(command 'xacro \'$(var robot_xurdf)\' model:=$(var robot_configuration) veh:=$(var veh)')"/>

    <node namespace="$(var veh)" pkg="robot_state_publisher" exec="robot_state_publisher"
          name="robot_state_publisher"/>

<!--     Camera Node: reads frames from a physical camera and produces ROS messages -->
    <group unless="$(var camera_disabled)">
        <group if="$(eval '\'$(var robot_type)\' in [\'duckiebot\', \'watchtower\', \'traffic_light\', \'duckiedrone\']')">
            <set_env name="VEH" value="$(var veh)"/>
            <set_env name="PARAM_FILE_NAME" value="$(var robot_type)"/>
            <include file="$(find-pkg-share camera_driver)/launch/camera_node.launch"/>
            <unset_env name="VEH"/>
            <unset_env name="PARAM_FILE_NAME"/>
        </group>
    </group>

<!--  i2c used -->
<!-- LED Driver: reads ROS messages and commands the LEDs -->
    <group if="$(eval '\'$(var robot_type)\' in [\'duckiebot\', \'traffic_light\']')">
        <set_env name="VEH" value="$(var veh)"/>
        <set_env name="PARAM_FILE_NAME" value="default"/>
        <include file="$(find-pkg-share led_driver)/launch/led_driver_node.launch"/>
        <unset_env name="VEH"/>
        <unset_env name="PARAM_FILE_NAME"/>
    </group>

<!--  i2c used -->
<!--     Joystick: reads from a physical joystick and produces ROS messages -->
    <group if="$(eval '\'$(var robot_type)\' == \'duckiebot\'')">
        <set_env name="VEH" value="$(var veh)"/>
        <set_env name="PARAM_FILE_NAME" value="$(var param_file_name)"/>
        <include file="$(find-pkg-share joystick)/launch/joystick_node.launch"/>

<!-- Wheel Drivers: reads ROS messages and spins the motors -->
        <include file="$(find-pkg-share wheels_driver)/launch/wheels_driver_node.launch"/>
        <unset_env name="VEH"/>
        <unset_env name="PARAM_FILE_NAME"/>
    </group>

<!--  .gpio used -->
<!--     Wheel Encoders (DB19 and above robot only): reads data from wheel encoders -->
    <group if="$(eval '\'$(var robot_type)\' == \'duckiebot\' and \'$(var robot_configuration)\' != \'DB18\'')">
<!--         Left Wheel Encoder -->
        <include file="$(find-pkg-share wheel_encoder)/launch/wheel_encoder_node.launch">
            <arg name="veh" value="$(var veh)"/>
            <arg name="wheel" value="left"/>
            <arg name="param_file_name" value="left_wheel"/>
            <arg name="node_name" value="wheel_encoder_left_node"/>
        </include>
<!--         Right Wheel Encoder -->
        <include file="$(find-pkg-share wheel_encoder)/launch/wheel_encoder_node.launch">
            <arg name="veh" value="$(var veh)"/>
            <arg name="wheel" value="right"/>
            <arg name="param_file_name" value="right_wheel"/>
            <arg name="node_name" value="wheel_encoder_right_node"/>
        </include>
    </group>

<!--     Time-of-Flight sensor: -->
<!--     - DB21x: 1x ToF sensor at the Front Center      -->
    <group if="$(eval '\'$(var robot_configuration)\' in [\'DB21M\', \'DB21J\', \'DBR4\']')">
       <include file="$(find-pkg-share tof_driver)/launch/tof_node.launch">
            <arg name="veh" value="$(var veh)"/>
            <arg name="name" value="front_center"/>
        </include>
    </group>

<!-- OLED Display driver: -->
    <group if="$(eval '\'$(var robot_configuration)\' in [\'DB21M\', \'DB21J\', \'DBR4\']')">
        <set_env name="VEH" value="$(var veh)"/>
        <include file="$(find-pkg-share display_driver)/launch/display_driver_node.launch"/>
        <unset_env name="VEH"/>
    </group>

<!-- Display renderers: -->
    <group if="$(eval '\'$(var robot_configuration)\' in [\'DB21M\', \'DB21J\', \'DBR4\']')">
        <set_env name="VEH" value="$(var veh)"/>
        health: renders health and usage info about the robot
        <include file="$(find-pkg-share display_renderers)/launch/health_renderer_node.launch"/>
        networking: renders connectivity status
        <include file="$(find-pkg-share display_renderers)/launch/networking_renderer_node.launch"/>
        robot_info: renders robot hostname, model and software firmware
        <include file="$(find-pkg-share display_renderers)/launch/robot_info_renderer_node.launch"/>
        <unset_env name="VEH"/>
    </group>

<!-- Button driver -->
    <group if="$(eval '\'$(var robot_configuration)\' in [\'DB21M\', \'DB21J\', \'DBR4\']')">
        <set_env name="VEH" value="$(var veh)"/>
        <include file="$(find-pkg-share button_driver)/launch/button_driver_node.launch"/>
        <unset_env name="VEH"/>
    </group>

<!-- IMU sensor: -->
    <group if="$(eval '\'$(var robot_configuration)\' in [\'DB21J\', \'DB21M\']')">
        <set_env name="VEH" value="$(var veh)"/>
        <include file="$(find-pkg-share imu_driver)/launch/imu_node.launch"/>
        <unset_env name="VEH"/>
    </group>


</launch>
